# 4.3.5.1 Running Dependencies deployment

### Preparation steps

This section explains how to deploy OpenCRVS dependencies grouped in 2 helm charts:

* **Ingress controller:** [Traefik](https://doc.traefik.io/traefik/) helm chart
* **Datastores** (via the [OpenCRVS dependencies Helm chart](https://github.com/opencrvs/infrastructure/tree/develop/charts/opencrvs-services)):
  * MongoDB
  * PostgreSQL
  * Elasticsearch
  * Redis
  * MinIO
  * InfluxDB

Environment configuration script (`yarn environment:init`) prepared configuration files (`values.yaml`) for deployment with default parameters. Navigate to `environments` folder inside infrastructure repository and review configuration files.

Here is an example directory structure for development environment:

```
environments/
├── development
│   ├── dependencies
│   │   └── values.yaml
│   ├── opencrvs-services
│   │   └── values.yaml
│   └── traefik
│       └── values.yaml
└── README.md
```

Default configuration created by `yarn environments:init` script is sufficient for inital deployment, but sometimes you may need to adjust TLS / SSL configuration in `environments/traefik/values.yaml` or tweak some properties here like static storage, etc.

### Run dependencies deployment

1. Navigate to GitHub Actions within `infrastructure` repository
2. Select "Deploy Dependencies" action
3. Select "Target environment" from dropdown menu, all environments created at [4.3.1-create-a-github-environment](../4.3.1-create-a-github-environment/ "mention") step should be listed here.
4. Click "Run workflow" button

### Verification steps

* Verify workflow was completed successfully
* Verify resources are up and running after deployment:
  * `kubectl get namespaces` : You should see 2 new namespaces created (`traefik`, `opencrvs-deps-<env>`).\
    NOTE: Check how to run `kubectl` at [Kubernetes cluster access](../../4.4-advanced-topics/4.3.5.2-kubernetes-cluster-access.md).
  * `kubectl get pods -n traefik`: Make sure traefik pod is up and running
  *   `kubectl get pods -n opencrvs-deps-<environment>` : make sure datastores are up and running.\
      Example output: If monitoring is enabled, you will also see filebeat, metricbeat, kibana pods.

      ```
      NAME                             READY   STATUS      RESTARTS     AGE
      elasticsearch-0                  1/1     Running     0            8d
      influxdb-0                       1/1     Running     0            8d
      minio-0                          1/1     Running     0            8d
      mongodb-0                        1/1     Running     0            8d
      postgres-0                       1/1     Running     0            8d
      redis-0                          1/1     Running     0            8d
      ```
* Verify that **MinIO** and **Kibana** are available:
  * Kibana URL: `https://kibana.<your domain>` \
    Username and password are stored as Kubernetes secret `elasticsearch-opencrvs-users` in `opencrvs-deps-<environment>` namespace.
  * MinIO URL: `https://minio.<your domain>` . Username and password are stored as Kubernetes secret `minio-opencrvs-users` in `opencrvs-deps-<environment>` namespace.

> NOTE: Credentials are stored at GitHub secrets or can be fetched namespace `opencrvs-deps-<env>`.
